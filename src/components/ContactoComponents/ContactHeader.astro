---
import { Icon } from "astro-icon/components";

import FacebookLogo from "../../assets/icons/FacebookLogo.astro";
import WhatsAppLogo from "../../assets/icons/WhatsAppLogo.astro";
import PhoneIcon from "../../assets/icons/PhoneIcon.astro";
import PeraltaAsociados from "../../assets/icons/PeraltaAsociados.astro";
import PeraltaAsociadosLight from "../../assets/icons/PeraltaAsociadosLight.astro";
import ChatBot from "../../assets/icons/ChatBot.astro";
---

<header class="">
  <!-- Primera fila - Redes sociales y teléfono -->
  <div class="bg-primary text-white">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <!-- Redes sociales -->
      <nav class="flex items-center gap-4" aria-label="Redes sociales">
        <a
          href="https://chat.peraltaasociados.com/"
          class="hover:text-secondary transition-colors duration-300 animate-pulse"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Conversa con nuestro asistente legal inteligente"
        >
          <span class="sr-only">Asistente Legal Inteligente</span>
          <ChatBot />
        </a>

        <div class="h-6 w-[1px] bg-white/50"></div>

        <a
          href="https://www.facebook.com/PeraltaAsociadosPeru/"
          class="hover:text-secondary transition-colors duration-300"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Visita nuestro perfil de Facebook"
        >
          <span class="sr-only">Facebook</span>
          <FacebookLogo />
        </a>

        <a
          href="https://api.whatsapp.com/send?phone=976762237"
          class="hover:text-secondary transition-colors duration-300"
          target="_blank"
          rel="noopener noreferrer"
          aria-label="Envíanos un mensaje por WhatsApp"
        >
          <span class="sr-only">WhatsApp</span>
          <WhatsAppLogo />
        </a>
      </nav>

      <!-- Teléfono -->
      <div class="flex items-center gap-2">
        <PhoneIcon />
        <a
          href="tel:976762237"
          class="text-sm hover:text-secondary transition-colors duration-300"
          aria-label="Llámanos al +51 976 762 237"
        >
          +51 976 762 237
        </a>
      </div>
    </div>
  </div>
</header>

<!-- Segunda fila - Logo, navegación y correo -->
<header class="bg-white/90 backdrop-blur-md shadow-lg sticky top-0 z-50">
  <div class="container mx-auto px-4 py-4">
    <div class="flex justify-between items-center">
      <!-- Logo y nombre de la empresa -->
      <a href="/">
        <figure class="flex items-center gap-4">
          <div class="text-primary" aria-hidden="true">
            <PeraltaAsociados />
          </div>
          <figcaption>
            <h1
              class="font-serif lg:text-2xl sm:text-xl text-lg font-bold text-primary"
            >
              Peralta Asociados
            </h1>
            <p class="text-sm text-gray-600 hidden lg:flex">
              Asesoría Legal en Huancavelica
            </p>
          </figcaption>
        </figure>
      </a>

      <!-- Navegación -->
      <nav class="hidden lg:block">
        <ul class="flex gap-8 font-merriweather">
          <li>
            <a
              href="#whatsApp"
              class="text-primary text-sm lg:text-base hover:text-secondary transition-colors duration-300"
            >
              WhatsApp
            </a>
          </li>
          <li>
            <a
              href="#correo"
              class="text-primary text-sm lg:text-base hover:text-secondary transition-colors duration-300"
            >
              Correo
            </a>
          </li>
          <li>
            <a
              href="#ubicacion"
              class="text-primary text-sm lg:text-base hover:text-secondary transition-colors duration-300"
            >
              Ubicación
            </a>
          </li>
          <li>
            <a
              href="#formulario"
              class="text-primary text-sm lg:text-base hover:text-secondary transition-colors duration-300"
            >
              Formulario
            </a>
          </li>
        </ul>
      </nav>

      <!-- Correo -->
      <div class="hidden xl:flex items-center gap-2">
        <a
          href="mailto:cyarupaitanp@gmail.com"
          class="flex items-center gap-2 text-primary hover:text-secondary transition-colors duration-300"
          aria-label="Envíanos un correo electrónico"
        >
          <svg
            class="w-4 h-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
            ></path>
          </svg>
          <span class="text-sm">cyarupaitanp@gmail.com</span>
        </a>
      </div>

      <!-- Botón menú móvil -->
      <button
        class="lg:hidden text-primary hover:text-secondary transition-colors duration-300 cursor-pointer"
        id="mobile-menu-button"
        aria-label="Abrir menú"
        aria-expanded="false"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
    </div>
  </div>
</header>

<!-- Menú móvil -->
<div
  id="mobile-menu"
  class="hidden fixed right-0 top-0 w-full h-full z-50 bg-white/90 backdrop-blur-sm transform transition-all duration-300"
  role="dialog"
  aria-modal="true"
>
  <div class="h-full w-full flex flex-col">
    <!-- Header -->
    <header class="bg-gradient-to-r from-primary to-primary/95 p-4 shadow-md">
      <div class="flex justify-between items-center">
        <!-- Logo -->
        <figure class="flex items-center gap-4">
          <div aria-hidden="true">
            <PeraltaAsociadosLight />
          </div>
          <figcaption>
            <h1
              class="font-serif lg:text-2xl sm:text-xl text-lg font-bold text-white"
            >
              Peralta Asociados
            </h1>
          </figcaption>
        </figure>

        <!-- Botón de cierre -->
        <button
          id="close-menu"
          class="text-white hover:text-secondary transition-all duration-300"
          aria-label="Cerrar menú"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </header>

    <!-- Navegación -->
    <nav class="my-5">
      <ul class="flex flex-col">
        {
          ["Inicio", "Servicios", "Nosotros", "Equipo", "Contacto"].map(
            (item) => (
              <li>
                <a
                  href={`#${item.toLowerCase()}`}
                  class="flex items-center gap-4 py-4 px-6 text-primary hover:bg-gray-50 transition-all duration-300 group"
                >
                  <Icon name="mdi:star-four-points" class="w-5 h-5" />
                  <span class="text-sm font-medium group-hover:translate-x-2 transition-transform duration-300">
                    {item}
                  </span>
                </a>
              </li>
            )
          )
        }
      </ul>
    </nav>
  </div>
</div>

<script>
  const mobileMenuButton = document.querySelector(
    "#mobile-menu-button"
  ) as HTMLButtonElement;
  const closeMenuButton = document.querySelector(
    "#close-menu"
  ) as HTMLButtonElement;
  const mobileMenu = document.querySelector("#mobile-menu") as HTMLDivElement;

  const toggleMenu = () => {
    const isHidden = mobileMenu.classList.contains("hidden");

    if (isHidden) {
      // Primero removemos hidden
      mobileMenu.classList.remove("hidden");

      // Esperamos al siguiente frame para añadir la animación
      requestAnimationFrame(() => {
        mobileMenu.style.transform = "translateX(0)";
        mobileMenu.style.opacity = "1";
      });
    } else {
      // Iniciamos la animación de salida
      mobileMenu.style.transform = "translateX(100%)";
      mobileMenu.style.opacity = "0";

      // Esperamos a que termine la animación
      mobileMenu.addEventListener(
        "transitionend",
        () => {
          mobileMenu.classList.add("hidden");
        },
        { once: true }
      );
    }

    document.body.classList.toggle("overflow-hidden");
    mobileMenuButton.setAttribute("aria-expanded", isHidden.toString());
  };

  const closeOnEscape = (e: KeyboardEvent) => {
    if (e.key === "Escape" && !mobileMenu.classList.contains("hidden")) {
      toggleMenu();
    }
  };

  mobileMenuButton.addEventListener("click", toggleMenu);
  closeMenuButton.addEventListener("click", toggleMenu);
  document.addEventListener("keydown", closeOnEscape);
</script>

<style>
  #mobile-menu {
    transform: translateX(100%);
    opacity: 0;
  }
</style>
